const fs = require("fs");
const path = require("path");

const commandsDir = path.join(__dirname, "..", "src", "commands");
const outputPath = path.join(commandsDir, "index.ts");
const ignore = new Set(["index.ts", "registry.ts", "types.ts"]);

const files = fs
  .readdirSync(commandsDir)
  .filter((file) => file.endsWith(".ts") && !ignore.has(file))
  .sort();

const imports = [];
const names = [];

for (const file of files) {
  const base = path.basename(file, ".ts");
  const name = toCamel(`command_${base}`);
  imports.push(`import ${name} from "./${base}";`);
  names.push(name);
}

const content = `// This file is auto-generated by scripts/gen-commands-index.js.
// Do not edit manually.
${imports.join("\n")}

export const commands = [${names.join(", ")}];
`;

fs.writeFileSync(outputPath, content, "utf8");
console.log(`Generated ${path.relative(process.cwd(), outputPath)}`);

function toCamel(value) {
  return value.replace(/[-_](\\w)/g, (_, c) => c.toUpperCase());
}
